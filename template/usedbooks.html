<!DOCTYPE html>
{% load cart %}
{% load custom_filter %}
{% load avgrating %}
<html>
<head>
    <title>UsedBook Page</title>
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link
 href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
 rel="stylesheet"
integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
 crossorigin="anonymous"
>

    <link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>


</head>
<style>

  .monospaced { font-family: 'Ubuntu Mono', monospaced ; }


</style>


<body style="background-color: rgb(211, 214, 214);">

{% for usedbook in usedbooks %}
<br>
<div class="container" id="product-section">
  <div class="row">
   <div class="col-md-5">
    <img
  src="{{usedbook.image.url}}"
  alt="book"
  class="image-responsive" width="350px" height="500px"
 />
   </div>
   <div class="col-md-7">
       <div class="row">
           <div class="col-md-12">
               <h1>{{usedbook.name}}</h1>
            </div>
       </div>
        <div class="row" style="font-size: 20px;">
          <div class="col-md-12">
              <span class="label label-primary">{{usedbook.category}}</span>
          </div>
        </div>
        <br>
       <div class="row">
           <div class="col-md-3">
           <span class="label label-warning" style="font-size:14px;">Average rating : {{reviewsn|avg_rating:usedbook.name}}</span>
               <br>
               <br>
               <span class="label label-success" style="font-size:14px;">Total Reviews : {{reviewsn|count:usedbook.name}}</span>

           </div>


       </div>
        <div class="row">
            <div class="col-md-12 bottom-rule">
                <h2 class="product-price">{{usedbook.price|currency}}</h2>
            </div>
        </div>

<hr>

   <div class="row">
    {% if usedbook|is_in_cart:request.session.cart %}
        <div class="col-md-6">
            <div class="btn-group-justified">

                <form action="/Home" method="post">
                    {% csrf_token %}
                    <input hidden type="text" name='product' value='{{usedbook.id}}'>
                    <input hidden type="text" name='remove' value='True'>
                    <input type="submit" value =" - " class="col-7 btn-lg btn-secondary">
                </form>

                <div class="text-center col-7 btn-lg btn-info">{{usedbook|cart_quantity:request.session.cart}} in Cart</div>

                <form action="/Home" method="post">
                    {% csrf_token %}
                    <input hidden type="text" name='product' value='{{usedbook.id}}'>
                    <input type="submit" value =" + " class="col-7 btn-lg btn-secondary">
                </form>

           </div>
        </div>
        {% else %}
            <div class="col-md-6">
                <form action="/Home" method="POST" >
                    {% csrf_token %}
                    <input hidden type="text" name='product' value='{{usedbook.id}}'>
                    <input type="submit" value="Add To Cart" class="col-7 btn-lg btn-info">

                </form>
            </div>
        {% endif %}
            <div class="col-md-5">

                <a href="{{usedbook.preview.url}}">
                <button type="button" class=" btn-lg btn-success">Book Preview</button></a>
            </div>
   </div><!-- end row -->


    <div class="row">
        <div class="col-md-12 bottom-rule top-10"></div>
    </div><!-- end row -->


<hr>
<!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist" style="font-size: 19px;">
        <li role="presentation" class="active">
            <a href="#description"
            aria-controls="description"
            role="tab"
            data-toggle="tab"
            ><b>Description</b></a>
        </li>
        <li role="presentation">
            <a href="#aboutauthor"
            aria-controls="aboutauthor"
            role="tab"
            data-toggle="tab"
            ><b>About Author</b></a>
        </li>
        <li role="presentation">
            <a href="#reviews"
            aria-controls="reviews"
            role="tab"
            data-toggle="tab"
            ><b>Reviews</b></a>
        </li>
    </ul>


       <!-- Tab panes -->
        <div class="tab-content" style="font-size: 17px; font-family: Georgia, 'Times New Roman', Times, serif;">
            <div role="tabpanel" class="tab-pane active" id="description">
                <br>
                <p class="top-10">
                 {{usedbook.description}}
                </p>
            </div>
            <div role="tabpanel" class="tab-pane top-10" id="aboutauthor">
                <br>
                <p class="top-10">
                 {{usedbook.aboutauthor}}
                </p>
            </div>
            <div role="tabpanel" class="tab-pane" id="reviews">
                   {% if reviewsn %}

                    {% for i in reviewsn %}
                        {% ifequal usedbook.name i.bookname %}
                            <h3>{{i.emailid}}</h3>
                         <h4>Review : {{i.reviews}}</h4>
                        <h4>Rating : {{i.rating}}</h4>
                        {% endifequal %}
                    {% endfor %}

                {% else %}
                    <h3>No reviews yet..</h3>
                {% endif %}
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="emailid" value="{{email}}">
                    <input type="hidden" name="bookname" value="{{usedbook.name}}">
                     <label>Choose a rating:</label>
                    <select name="rating">
                        <option type="number" value=5>5</option>
                        <option type="number" value=4>4</option>
                        <option type="number" value=3>3</option>
                        <option type="number" value=2>2</option>
                        <option type="number" value=1>1</option>
                    </select>
                    <br>
                    <input type="text" name="reviews" placeholder="Write your review here...." style="height:200px;width:500px;
                    border-radius: 15px;
  background-color:#f2f2f2;
  padding: 50px;    ">
                    <br>
                    <input type="submit">
                    {% if error %}
						<div class="alert alert-info" role="alert">
							{{error}}
						</div>
						{% endif %}
                </form>
            </div>
        </div>

   </div>

  </div><!-- end row -->

 </div><!-- end container -->

{% endfor %}


<script
     src="https://code.jquery.com/jquery-2.2.2.min.js"
     integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI="
     crossorigin="anonymous"></script>
 <script
     src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
     integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
     crossorigin="anonymous"></script>
</body>
</html>